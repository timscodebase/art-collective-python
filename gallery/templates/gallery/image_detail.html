{% extends 'base.html' %}

{% block content %}
<main class="container">
    <article>
        <header>
            <h2>{{ image.title }}</h2>
            <p>Uploaded by: <a href="{% url 'gallery:user_profile' image.user.username %}">{{ image.user.username }}</a></p>
        </header>
    
        <figure>
            <img src="{{ image.image.url }}" alt="{{ image.title }}" class="detail-image">
        </figure>

        {% if image.user == user %}
        <a href="{% url 'gallery:delete_image' pk=image.pk %}" role="button" class="contrast">Delete Image</a>
        {% endif %}

        <section>
            <h3>Comments</h3>
            <form method="post">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit">Post Comment</button>
            </form>
            <hr>
            {% for comment in comments %}
                <article>
                    <header>
                        <strong>{{ comment.user.username }}</strong>
                        <small>on {{ comment.created_at|date:"N j, Y" }}</small>
                    </header>
                    <p>{{ comment.text|linebreaksbr }}</p>
                    <footer>
                        {% if user == comment.user %}
                            <form action="{% url 'gallery:delete_comment' comment.pk %}" method="post" style="margin-bottom: 0;">
                                {% csrf_token %}
                                <button type="submit" class="pico-link-button" onclick="return confirm('Are you sure you want to delete this comment?');">Delete</button>
                            </form>
                        {% endif %}
                    </footer>
                </article>
            {% empty %}
                <p>No comments yet. Be the first to leave one!</p>
            {% endfor %}
        </section>
    </article>
</main>
{% endblock %}